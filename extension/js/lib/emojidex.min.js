/*
 * jQuery emojidex - v0.4.7
 * emojidex plugin for jQuery/Zepto and compatible
 * https://github.com/emojidex/emojidex-web
 *
 * Includes:
 *   emojidexReplace, emojidexAutocomplete
 *
 * =LICENSE=
 * Licensed under the emojidex Open License
 * https://www.emojidex.com/emojidex/emojidex_open_license
 *
 * Copyright 2013 Genshin Souzou Kabushiki Kaisha
 *
 *
 * Includes:
 * --------------------------------
 * emojidex client - v0.3.6
 * * Provides search, index caching and combining and asset URI resolution
 * https://github.com/emojidex/emojidex-web-client
 *
 * =LICENSE=
 * Licensed under the emojidex Open License
 * https://www.emojidex.com/emojidex/emojidex_open_license
 *
 * Copyright 2013 Genshin Souzou Kabushiki Kaisha
 *
 *
 * Includes:
 * --------------------------------
 * jQuery Storage API Plugin
 *
 * Copyright (c) 2013 Julien Maurel
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Project home:
 * https://github.com/julien-maurel/jQuery-Storage-API
 *
 * Version: 1.7.3
 *
 * --------------------------------
 * --------------------------------
 */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){function b(b){var c,d,e,f=arguments.length,g=window[b],h=arguments,i=h[1];if(2>f)throw new Error("Minimum 2 arguments must be given");if(a.isArray(i)){d={};for(var j in i){c=i[j];try{d[c]=JSON.parse(g.getItem(c))}catch(k){d[c]=g.getItem(c)}}return d}if(2!=f){try{d=JSON.parse(g.getItem(i))}catch(k){throw new ReferenceError(i+" is not defined in this storage")}for(var j=2;f-1>j;j++)if(d=d[h[j]],void 0===d)throw new ReferenceError([].slice.call(h,1,j+1).join(".")+" is not defined in this storage");if(a.isArray(h[j])){e=d,d={};for(var l in h[j])d[h[j][l]]=e[h[j][l]];return d}return d[h[j]]}try{return JSON.parse(g.getItem(i))}catch(k){return g.getItem(i)}}function c(b){var c,d,e=arguments.length,f=window[b],g=arguments,h=g[1],i=g[2],j={};if(2>e||!a.isPlainObject(h)&&3>e)throw new Error("Minimum 3 arguments must be given or second parameter must be an object");if(a.isPlainObject(h)){for(var k in h)c=h[k],a.isPlainObject(c)?f.setItem(k,JSON.stringify(c)):f.setItem(k,c);return h}if(3==e)return"object"==typeof i?f.setItem(h,JSON.stringify(i)):f.setItem(h,i),i;try{d=f.getItem(h),null!=d&&(j=JSON.parse(d))}catch(l){}d=j;for(var k=2;e-2>k;k++)c=g[k],d[c]&&a.isPlainObject(d[c])||(d[c]={}),d=d[c];return d[g[k]]=g[k+1],f.setItem(h,JSON.stringify(j)),j}function d(b){var c,d,e=arguments.length,f=window[b],g=arguments,h=g[1];if(2>e)throw new Error("Minimum 2 arguments must be given");if(a.isArray(h)){for(var i in h)f.removeItem(h[i]);return!0}if(2==e)return f.removeItem(h),!0;try{c=d=JSON.parse(f.getItem(h))}catch(j){throw new ReferenceError(h+" is not defined in this storage")}for(var i=2;e-1>i;i++)if(d=d[g[i]],void 0===d)throw new ReferenceError([].slice.call(g,1,i).join(".")+" is not defined in this storage");if(a.isArray(g[i]))for(var k in g[i])delete d[g[i][k]];else delete d[g[i]];return f.setItem(h,JSON.stringify(c)),!0}function e(b,c){var e=h(b);for(var f in e)d(b,e[f]);if(c)for(var f in a.namespaceStorages)i(f)}function f(c){var d=arguments.length,e=arguments,g=(window[c],e[1]);if(1==d)return 0==h(c).length;if(a.isArray(g)){for(var i=0;i<g.length;i++)if(!f(c,g[i]))return!1;return!0}try{var j=b.apply(this,arguments);a.isArray(e[d-1])||(j={totest:j});for(var i in j)if(!(a.isPlainObject(j[i])&&a.isEmptyObject(j[i])||a.isArray(j[i])&&!j[i].length)&&j[i])return!1;return!0}catch(k){return!0}}function g(c){var d=arguments.length,e=arguments,f=(window[c],e[1]);if(2>d)throw new Error("Minimum 2 arguments must be given");if(a.isArray(f)){for(var h=0;h<f.length;h++)if(!g(c,f[h]))return!1;return!0}try{var i=b.apply(this,arguments);a.isArray(e[d-1])||(i={totest:i});for(var h in i)if(void 0===i[h]||null===i[h])return!1;return!0}catch(j){return!1}}function h(c){var d=arguments.length,e=window[c],f=arguments,g=(f[1],[]),h={};if(h=d>1?b.apply(this,f):e,h._cookie)for(var i in a.cookie())""!=i&&g.push(i.replace(h._prefix,""));else for(var j in h)g.push(j);return g}function i(b){if(!b||"string"!=typeof b)throw new Error("First parameter must be a string");m?(window.localStorage.getItem(b)||window.localStorage.setItem(b,"{}"),window.sessionStorage.getItem(b)||window.sessionStorage.setItem(b,"{}")):(window.localCookieStorage.getItem(b)||window.localCookieStorage.setItem(b,"{}"),window.sessionCookieStorage.getItem(b)||window.sessionCookieStorage.setItem(b,"{}"));var c={localStorage:a.extend({},a.localStorage,{_ns:b}),sessionStorage:a.extend({},a.sessionStorage,{_ns:b})};return a.cookie&&(window.cookieStorage.getItem(b)||window.cookieStorage.setItem(b,"{}"),c.cookieStorage=a.extend({},a.cookieStorage,{_ns:b})),a.namespaceStorages[b]=c,c}function j(a){if(!window[a])return!1;var b="jsapi";try{return window[a].setItem(b,b),window[a].removeItem(b),!0}catch(c){return!1}}var k="ls_",l="ss_",m=j("localStorage"),n={_type:"",_ns:"",_callMethod:function(a,b){var c=[this._type],b=Array.prototype.slice.call(b),d=b[0];return this._ns&&c.push(this._ns),"string"==typeof d&&-1!==d.indexOf(".")&&(b.shift(),[].unshift.apply(b,d.split("."))),[].push.apply(c,b),a.apply(this,c)},get:function(){return this._callMethod(b,arguments)},set:function(){var b=arguments.length,d=arguments,e=d[0];if(1>b||!a.isPlainObject(e)&&2>b)throw new Error("Minimum 2 arguments must be given or first parameter must be an object");if(a.isPlainObject(e)&&this._ns){for(var f in e)c(this._type,this._ns,f,e[f]);return e}var g=this._callMethod(c,d);return this._ns?g[e.split(".")[0]]:g},remove:function(){if(arguments.length<1)throw new Error("Minimum 1 argument must be given");return this._callMethod(d,arguments)},removeAll:function(a){return this._ns?(c(this._type,this._ns,{}),!0):e(this._type,a)},isEmpty:function(){return this._callMethod(f,arguments)},isSet:function(){if(arguments.length<1)throw new Error("Minimum 1 argument must be given");return this._callMethod(g,arguments)},keys:function(){return this._callMethod(h,arguments)}};if(a.cookie){window.name||(window.name=Math.floor(1e8*Math.random()));var o={_cookie:!0,_prefix:"",_expires:null,_path:null,_domain:null,setItem:function(b,c){a.cookie(this._prefix+b,c,{expires:this._expires,path:this._path,domain:this._domain})},getItem:function(b){return a.cookie(this._prefix+b)},removeItem:function(b){return a.removeCookie(this._prefix+b)},clear:function(){for(var b in a.cookie())""!=b&&(!this._prefix&&-1===b.indexOf(k)&&-1===b.indexOf(l)||this._prefix&&0===b.indexOf(this._prefix))&&a.removeCookie(b)},setExpires:function(a){return this._expires=a,this},setPath:function(a){return this._path=a,this},setDomain:function(a){return this._domain=a,this},setConf:function(a){return a.path&&(this._path=a.path),a.domain&&(this._domain=a.domain),a.expires&&(this._expires=a.expires),this},setDefaultConf:function(){this._path=this._domain=this._expires=null}};m||(window.localCookieStorage=a.extend({},o,{_prefix:k,_expires:3650}),window.sessionCookieStorage=a.extend({},o,{_prefix:l+window.name+"_"})),window.cookieStorage=a.extend({},o),a.cookieStorage=a.extend({},n,{_type:"cookieStorage",setExpires:function(a){return window.cookieStorage.setExpires(a),this},setPath:function(a){return window.cookieStorage.setPath(a),this},setDomain:function(a){return window.cookieStorage.setDomain(a),this},setConf:function(a){return window.cookieStorage.setConf(a),this},setDefaultConf:function(){return window.cookieStorage.setDefaultConf(),this}})}a.initNamespaceStorage=function(a){return i(a)},m?(a.localStorage=a.extend({},n,{_type:"localStorage"}),a.sessionStorage=a.extend({},n,{_type:"sessionStorage"})):(a.localStorage=a.extend({},n,{_type:"localCookieStorage"}),a.sessionStorage=a.extend({},n,{_type:"sessionCookieStorage"})),a.namespaceStorages={},a.removeAllStorages=function(b){a.localStorage.removeAll(b),a.sessionStorage.removeAll(b),a.cookieStorage&&a.cookieStorage.removeAll(b),b||(a.namespaceStorages={})}}),function(){var a,b,c,d,e,f,g,h,i,j=function(a,b){return function(){return a.apply(b,arguments)}};this.EmojidexClient=function(){function g(g){this.options=g,this.env={api_ver:1,cdn_addr:"cdn.emojidex.com",s_cdn_addr:"",asset_addr:"assets.emojidex.com",s_asset_addr:""},this.defaults={locale:"en",api_url:"https://www.emojidex.com/api/v1/",cdn_url:"http://"+this.env.cdn_addr+"/emoji/",closed_net:!1,min_query_len:4,size_code:"px32",detailed:!1,limit:32},this.options=$.extend({},this.defaults,this.options),this.closed_net=this.options.closed_net,this.api_url=this.options.api_url,this.cdn_url=this.options.cdn_url,this.size_code=this.options.size_code,this.detailed=this.options.detailed,this.limit=this.options.limit,this.locale=this.options.locale,this.Data=new b(this),this.Categories=new a(this),this.User=new f(this),this.Indexes=new d(this),this.Util=new i(this),this.Search=new e(this),this.Emoji=new c(this)}return g}(),a=function(){function a(a){var b;this.EC=a,this._categories=this.EC.Data.categories(),b=this.EC.Data.categories(),0===b&&this.sync()}return a.prototype.sync=function(a,b){var c=this;return null==b&&(b=this.EC.locale),$.ajax({url:this.EC.api_url+"categories",dataType:"json",data:{locale:b},success:function(b){return c._categories,"function"==typeof a?a(b.categories):void 0}})},a.prototype.all=function(){return this._categories},a}(),b=function(){function a(a){var b=this;this.EC=a,this._def_auth_info={status:"none",user:"",token:null},this.storage=$.localStorage,this.storage.isSet("emojidex")||this.storage.set("emojidex",{}),this.storage.isSet("emojidex.emoji")||this.storage.set("emojidex.emoji",this.EC.options.emoji||[]),this.storage.isSet("emojidex.history")||this.storage.set("emojidex.history",this.EC.options.history||[]),this.storage.isSet("emojidex.favorites")||this.storage.set("emojidex.favorites",this.EC.options.favorites||[]),this.storage.isSet("emojidex.auth_info")||this.storage.set("emojidex.categories",this.EC.options.categories||[]),this.storage.isSet("emojidex.auth_info")||this.storage.set("emojidex.auth_info",this.EC.options.auth_info||this._def_auth_info),this.storage.get("emojidex.cdn_url")?this.EC.cdn_url=this.storage.get("emojidex.cdn_url"):this.EC.cdn_url===this.EC.defaults.cdn_url&&this.EC.closed_net===!1&&$.ajax({url:this.EC.api_url+"/env",dataType:"json",success:function(a){return b.EC.env=a,b.EC.cdn_url="https://"+b.EC.env.s_cdn_addr+"/emoji/",b.EC.Data.storage.set("emojidex.cdn_url",b.EC.cdn_url)}})}return a.prototype.emoji=function(a){return this.storage.isEmpty("emojidex.emoji")?this.storage.set("emojidex.emoji",a):this.storage.set("emojidex.emoji",this.storage.get("emojidex.emoji").concat(a)),this.EC.Emoji._emoji=this.storage.get("emojidex.emoji"),this.storage.get("emojidex.emoji")},a.prototype.favorites=function(a){return null!=a&&this.storage.set("emojidex.favorites",a),this.storage.get("emojidex.favorites")},a.prototype.history=function(a){return null!=a&&this.storage.set("emojidex.history",a),this.storage.get("emojidex.history")},a.prototype.categories=function(a){return null!=a&&this.storage.set("emojidex.categories",a),this.storage.get("emojidex.categories")},a.prototype.auth_info=function(a){return null!=a&&this.storage.set("emojidex.auth_info",a),this.storage.get("emojidex.auth_info")},a}(),c=function(){function a(a){this.EC=a,this.combine=j(this.combine,this),this.checkUpdate()?this._emoji=this.EC.Data.storage.get("emojidex.emoji"):(this.EC.Data.storage.set("emojidex.seedUpdated",(new Date).toString()),this.EC.Data.storage.remove("emojidex.emoji"),this.seed(this.set_emoji_data))}return a.prototype.checkUpdate=function(){var a,b;return this.EC.Data.storage.isSet("emojidex.seedUpdated")?(a=new Date,b=new Date(this.EC.Data.storage.get("emojidex.seedUpdated")),1728e5>=a-b?!0:!1):!1},a.prototype.seed=function(a){return this.EC.Indexes["static"]("utf_emoji",a),this.EC.Indexes["static"]("extended_emoji",a)},a.prototype.all=function(){return this._emoji},a.prototype.search=function(a,b){var c,d;return d=function(){var b,d,e,f;for(e=this._emoji,f=[],b=0,d=e.length;d>b;b++)c=e[b],c.code.match(a)&&f.push(c);return f}.call(this),"function"==typeof b&&b(d),d},a.prototype.starting=function(a,b){var c,d;return d=function(){var b,d,e,f;for(e=this._emoji,f=[],b=0,d=e.length;d>b;b++)c=e[b],c.code.match("^"+a)&&f.push(c);return f}.call(this),"function"==typeof b&&b(d),d},a.prototype.ending=function(a,b){var c,d;return d=function(){var b,d,e,f;for(e=this._emoji,f=[],b=0,d=e.length;d>b;b++)c=e[b],c.code.match(a+"$")&&f.push(c);return f}.call(this),"function"==typeof b&&b(d),d},a.prototype.tags=function(a,b){var c,d,e,f,g,h;for(a=this.EC.Util.breakout(a),e=b.selection||this._emoji,c=[],g=0,h=a.length;h>g;g++)f=a[g],c.concat(function(){var a,b,c;for(c=[],a=0,b=e.length;b>a;a++)d=e[a],$.inArray(f,d.tags)>=0&&c.push(d);return c}());return c},a.prototype.categories=function(a,b){var c,d,e,f,g,h;for(a=this.EC.Util.breakout(a),f=b.selection||this._emoji,d=[],g=0,h=a.length;h>g;g++)c=a[g],d.concat(function(){var a,b,d;for(d=[],a=0,b=f.length;b>a;a++)e=f[a],e.category===c&&d.push(e);return d}());return d},a.prototype.advanced=function(a){return this.categories(a.categories,{selection:this.tags(a.tags,{selection:this.search(a.term)})})},a.prototype.combine=function(a){return this._emoji=this.EC.Data.emoji(a)},a.prototype.flush=function(){return this._emoji=this.EC.Data.emoji([])},a}(),d=function(){function a(a){this.EC=a,this.results=[],this.cur_page=1,this.count=0}return a.prototype._indexesAPI=function(a,b,c,d){var e,f=this;return e={page:1,limit:this.EC.limit,detailed:this.EC.detailed},$.extend(e,c),null!=d&&(this.indexed_func=d,this.indexed={query:a,callback:b,param:e}),$.ajax({url:this.EC.api_url+a,dataType:"json",data:e,success:function(a){return f.results=a.emoji,f.cur_page=a.meta.page,f.count=a.meta.count,f.EC.Emoji.combine(a.emoji),"function"==typeof b?b(a.emoji):void 0},error:function(){return f.results=[]}})},a.prototype.index=function(a,b){return this._indexesAPI("emoji",a,b,this.index)},a.prototype.newest=function(a,b){return this._indexesAPI("newest",a,b,this.newest)},a.prototype.popular=function(a,b){return this._indexesAPI("popular",a,b,this.popular)},a.prototype.user=function(a,b,c){return this._indexesAPI("users/"+a+"/emoji",b,c)},a.prototype["static"]=function(a){var b=this;return $.ajax({url:this.EC.api_url+a,dataType:"json",success:function(a){return b.EC.Emoji.combine(a)}})},a.prototype.select=function(a,b,c){return this.EC.Search.find(a,b,c)},a.prototype.next=function(){return this.count===this.indexed.param.limit&&this.indexed.param.page++,this.indexed_func(this.indexed.data,this.indexed.callback,this.indexed.param,this.indexed_func)},a.prototype.prev=function(){return this.indexed.param.page>1&&this.indexed.param.page--,this.indexed_func(this.indexed.data,this.indexed.callback,this.indexed.param,this.indexed_func)},a}(),e=function(){function a(a){this.EC=a,this.Util=new i,this.results=[],this.cur_page=1,this.count=0}return a.prototype._searchAPI=function(a,b,c,d){var e,f=this;return e={page:1,limit:this.EC.limit,detailed:this.EC.detailed},$.extend(e,c),this.searched_func=d.ajax,this.searched={data:a,callback:b,param:e},this.EC.closed_net?"function"==typeof d.storage?d.storage(a,b):void 0:$.ajax({url:this.EC.api_url+"search/emoji",dataType:"json",data:e,success:function(a){return f.results=a.emoji,f.cur_page=a.meta.page,f.count=a.meta.count,f.EC.Emoji.combine(a.emoji),"function"==typeof b?b(a.emoji):void 0},error:function(){return f.results=[]}})},a.prototype.search=function(a,b,c){return c=$.extend({code_cont:this.EC.Util.escape_term(a)},c),this._searchAPI(a,b,c,{ajax:this.search,storage:this.EC.Emoji.search})},a.prototype.starting=function(a,b,c){return c=$.extend({code_sw:this.Util.escape_term(a)},c),this._searchAPI(a,b,c,{ajax:this.starting,storage:this.EC.Emoji.starting})},a.prototype.ending=function(a,b,c){return c=$.extend({code_ew:this.Util.escape_term(a)},c),this._searchAPI(a,b,c,{ajax:this.ending,storage:this.EC.Emoji.ending})},a.prototype.tags=function(a,b,c){return c=$.extend({"tags[]":this.Util.breakout(a)},c),this._searchAPI(a,b,c,{ajax:this.tags,storage:this.EC.Emoji.tags})},a.prototype.advanced=function(a,b,c){var d;return d={code_cont:this.Util.escape_term(a.term),"tags[]":this.Util.breakout(a.tags),"categories[]":this.Util.breakout(a.categories)},$.extend(d,c),this._searchAPI(a,b,d,{ajax:this.advanced,storage:this.EC.Emoji.advanced})},a.prototype.find=function(a,b,c){var d,e=this;return d={detailed:this.EC.detailed},$.extend(d,c),this.EC.closed_net?void 0:$.ajax({url:this.EC.api_url+("/emoji/"+a),dataType:"json",data:d,success:function(a){return e.EC.Emoji.combine([a]),"function"==typeof b?b(a):void 0}})},a.prototype.next=function(){return this.count===this.searched.param.limit&&this.searched.param.page++,this.searched_func(this.searched.data,this.searched.callback,this.searched.param,{ajax:this.searched_func})},a.prototype.prev=function(){return this.searched.param.page>1&&this.searched.param.page--,this.searched_func(this.searched.data,this.searched.callback,this.searched.param,{ajax:this.searched_func})},a}(),f=function(){function a(a){this.EC=a,this.auth_info=this.EC.Data._def_auth_info,this.History=new h(this.EC),this.Favorites=new g(this.EC),this._auto_login()}return a.prototype._auto_login=function(){return this.closed_net?void 0:(this.auth_info=this.EC.Data.auth_info(),null!=this.auth_info.token?this.sync_user_data():this.logout())},a.prototype.login=function(a){switch(a.authtype){case"plain":return this.plain_auth(a.username,a.password,a.callback);case"basic":return this.basic_auth(a.user,a.pass,a.callback);case"google":return this.google_auth(a.callback);default:return this._auto_login()}},a.prototype.logout=function(){return this.EC.Data.auth_info(this.EC.Data._def_auth_info)},a.prototype.plain_auth=function(a,b,c){var d=this;return null==c&&(c=null),$.ajax({url:this.EC.api_url+"users/authenticate",dataType:"json",data:{username:a,password:b},success:function(a){return d._set_auth_from_response(a),"function"==typeof c?c(d.auth_info):void 0},error:function(a){return d.auth_info=d.EC.Data.auth_info({status:a.auth_status,token:null,user:""})}})},a.prototype.basic_auth=function(a,b,c){return null==c&&(c=null),!1},a.prototype.google_auth=function(a){return null==a&&(a=null),!1},a.prototype.set_auth=function(a,b){return this.auth_info=this.EC.Data.auth_info({status:"verified",token:b,user:a}),this.sync_user_data()},a.prototype._set_auth_from_response=function(a){return this.auth_info=this.EC.Data.auth_info({status:a.auth_status,token:a.auth_token,user:a.auth_user}),this.sync_user_data()},a.prototype.sync_user_data=function(){return this.History.token=this.Favorites.token=this.auth_info.token,this.Favorites.sync(),this.History.sync()},a}(),g=function(){function a(a,b){this.EC=a,null==b&&(b=null),this.token=b,this._favorites=this.EC.Data.favorites()}return a.prototype._favoritesAPI=function(a){var b;return null!=this.token?(b={url:this.EC.api_url+"users/favorites",dataType:"json"},$.ajax($.extend(b,a))):void 0},a.prototype.get=function(a){var b,c=this;return b={data:{auth_token:this.token},success:function(b){return c._favorites=c.EC.Data.favorites(b),"function"==typeof a?a(c._favorites):void 0}},this._favoritesAPI(b)},a.prototype.set=function(a){var b,c=this;return b={type:"POST",data:{auth_token:this.token,emoji_code:a},success:function(a){return c._favorites.push(a),c.EC.Data.favorites(c._favorites)}},this._favoritesAPI(b)},a.prototype.unset=function(a){var b,c=this;return b={type:"DELETE",data:{auth_token:this.token,emoji_code:a},success:function(){return c.sync()}},this._favoritesAPI(b)},a.prototype.sync=function(){return this.get()},a.prototype.all=function(){return this._favorites},a}(),h=function(){function a(a,b){this.EC=a,null==b&&(b=null),this.token=b,this._history=this.EC.Data.history()}return a.prototype._historyAPI=function(a){var b;return null!=this.token?(b={url:this.EC.api_url+"users/history",dataType:"json"},$.ajax($.extend(b,a))):void 0},a.prototype.get=function(){var a,b=this;return a={data:{auth_token:this.token},success:function(a){return b._history=b.EC.Data.history(a)}},this._historyAPI(a)},a.prototype.set=function(a){var b,c=this;return b={type:"POST",data:{auth_token:this.token,emoji_code:a},success:function(a){var b,d,e,f,g;for(g=c._history,d=e=0,f=g.length;f>e;d=++e)if(b=g[d],b.emoji_code===a.emoji_code)return c._history[d]=a,c.EC.Data.history(c._history),a}},this._historyAPI(b)},a.prototype.sync=function(){return this.get()},a.prototype.all=function(){return this._history},a}(),i=function(){function a(a){this.EC=a}return a.prototype.escape_term=function(a){return a.replace(/\s/g,"_").replace(/(\(|\))/g,"\\$1")},a.prototype.de_escape_term=function(a){return a.replace(/_/g," ")},a.prototype.breakout=function(a){return null==a?[]:a instanceof Array?void 0:a=[a]},a.prototype.simplify=function(a,b){var c,d,e,f;for(null==a&&(a=this.results),null==b&&(b=this.EC.size_code),f=[],d=0,e=a.length;e>d;d++)c=a[d],f.push({code:this.escape_term(c.code),img_url:""+this.EC.cdn_url+"/"+b+"/"+this.escape_term(c.code)+".png"});return f},a}()}.call(this),function(){var a;!function(b){var c,d,e;return e="emojidexAutocomplete",d={limit:10,insertImg:!0},c=function(){function c(c,f){this.element=c,this.options=b.extend({},d,f),this._defaults=d,this._name=e,this.autocomplete=new a(this),this.autocomplete.setAutoComplete()}return c}(),b.fn[e]=function(a){return this.each(function(){return b.data(this,"plugin_"+e)?void 0:b.data(this,"plugin_"+e,new c(this,a))})}}(jQuery,window,document),a=function(){function a(a){this.plugin=a,this.searching_num=0}return a.prototype.setAutoComplete=function(){var a,b,c,d,e,f,g,h=this;return f=function(a){return $(h.plugin.element).atwho(a).on("reposition.atwho",function(b){return $(b.currentTarget).atwho(a)}).on("hidden.atwho",function(b){return $(b.currentTarget).atwho(a)})},g=function(a,f){var g,i;return i=function(a,b){var f;return f={data:a,callbacks:{highlighter:e,matcher:function(a,b,e){var f;return f=c(b,d(a,e))}}},b.$inputor.atwho("destroy").atwho($.extend({},b.setting,f)).atwho("run")},g=++h.searching_num,b.Search.search(f,function(){var c,d;return d=function(){var a,d,e,f;for(e=b.Search.results,f=[],a=0,d=e.length;d>a;a++)c=e[a],f.push({code:c.code.replace(/\s/g,"_"),img_url:""+b.cdn_url+b.size_code+"/"+c.code.replace(/\s/g,"_")+".png"});return f}(),h.searching_num===g?(d.length&&i(d,a),h.searching_num=0):void 0}),f},d=function(a){var b,c,d;return c=decodeURI("%C3%80"),d=decodeURI("%C3%BF"),b=new RegExp("[："+a+"]([^：:;@&#~!$+?%*\f\n\r\\/]+)$","gi")},c=function(a,b){var c;return c=b.exec(a),c=c?c[2]||c[1]:null},e=function(a,b){var c;return b?(c=new RegExp(">\\s*([^:;@&#~!$+?%*\f\n\r\\/]*?)("+b.replace(/(\(|\))/g,"\\$1")+")([^:;@&#~!$+?%*\f\n\r\\/]*)\\s*<","ig"),a.replace(c,function(a,b,c,d){return"> "+b+"<strong>"+c+"</strong>"+d+" <"})):a},b=new EmojidexClient,a={at:":",suffix:"",limit:this.plugin.options.limit,search_key:"code",tpl:"<li data-value=':${code}:'><img src='${img_url}' height='20' width='20'></img>${code}</li>",insert_tpl:this.plugin.options.insertImg?"<img src='${img_url}' height='20' width='20' />":":${code}:",callbacks:{highlighter:e,matcher:function(a,b,e){var f;return f=c(b,d(a,e)),f?g(this,f):void 0}}},f(a)},a}()}.call(this),function(){var a;!function(b){var c,d,e;return e="emojidexPallet",d={switch_element:b("#pallet-btn")},c=function(){function c(c,f){this.element=c,this.options=b.extend({},d,f),this._defaults=d,this._name=e,this.pallet=new a}return c}(),b.fn[e]=function(a){return this.each(function(){return b.data(this,"plugin_"+e)?void 0:b.data(this,"plugin_"+e,new c(this,a))})}}(jQuery,window,document),a=function(){function a(a,b,c){this.emoji_data_array=a,this.element=b,this.options=c,this.KEY_ESC=27,this.KEY_TAB=9}return a.prototype.setPallet=function(){},a}()}.call(this),function(){var a,b,c,d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},f=function(a,b){return function(){return a.apply(b,arguments)}};!function(a){var d,e,f;return f="emojidexReplace",e={onComplete:void 0,useLoadingImg:!0,useUserEmoji:!1,userNames:["emoji","emojidex"]},d=function(){function d(b,c){var d=this;this.element=b,this.element=a(this.element),this.options=a.extend({},e,c),this._defaults=e,this._name=f,this.ec=new EmojidexClient,this.checkUpdate()?(this.options.regexpUtf=RegExp(this.ec.Data.storage.get("emojidex.regexpUtf"),"g"),this.options.utfEmojiData=this.ec.Data.storage.get("emojidex.utfEmojiData"),this.replace()):a.ajax({url:this.ec.api_url+"moji_codes",dataType:"json",success:function(a){var b;return d.ec.Data.storage.set("emojidex.utfInfoUpdated",(new Date).toString()),b=a.moji_array.join("|"),d.ec.Data.storage.set("emojidex.regexpUtf",b),d.options.regexpUtf=RegExp(b,"g"),d.ec.Data.storage.set("emojidex.utfEmojiData",a.moji_index),d.options.utfEmojiData=a.moji_index,d.replace()}})}return d.prototype.checkUpdate=function(){var a,b;return this.ec.Data.storage.isSet("emojidex.utfInfoUpdated")?(a=new Date,b=new Date(this.ec.Data.storage.get("emojidex.utfInfoUpdated")),1728e5>=a-b?!0:!1):!1},d.prototype.replace=function(){return this.replacer=this.options.useUserEmoji?new c(this):new b(this),this.replacer.loadEmoji()},d}(),a.fn[f]=function(b){return this.each(function(){return a.data(this,"plugin_"+f)?void 0:a.data(this,"plugin_"+f,new d(this,b))})}}(jQuery,window,document),a=function(){function a(){var a;this.loadingNum=void 0,a="'\":;@&#~{}<>\\r\\n\\[\\]\\!\\$\\+\\?\\%\\*\\/\\\\",this.regexpCode=RegExp(":([^\\s"+a+"][^"+a+"]*[^\\s"+a+"]):|:([^\\s"+a+"]):","g")}return a.prototype.getEmojiTag=function(a){return"<img class='emojidex-emoji' src='"+this.plugin.ec.cdn_url+this.plugin.ec.size_code+"/"+a+".png' title='"+this.replaceUnderToSpace(a)+"'></img>"},a.prototype.getLoadingTag=function(a,b){return"<img class='emojidex-loading-icon' data-emoji='"+a+"' data-type='"+b+"'></img>"},a.prototype.getLoadingElement=function(a){return $(a.find(".emojidex-loading-icon"))},a.prototype.setLoadingTag=function(a){var b=this;return a.element.find(":not(iframe,textarea,script)").andSelf().contents().filter(function(a,c){var d;return"STYLE"!==c.parentElement.tagName&&c.nodeType===Node.TEXT_NODE&&c.textContent.match(/\S/)&&(d=b.getTextWithLoadingTag(c.textContent),d!==c.textContent)?$(c).replaceWith(d):void 0})},a.prototype.getTextWithLoadingTag=function(a){var b,c=this;return b=a,a=a.replace(this.plugin.options.regexpUtf,function(a){return c.getLoadingTag(a,"utf")}),a=a.replace(this.regexpCode,function(a){return c.getLoadingTag(a,"code")})},a.prototype.fadeOutLoadingTag_fadeInEmojiTag=function(a,b,c){var d,e=this;return null==c&&(c=!0),d=void 0,d=c?$(this.getEmojiTag(b)).hide():b,a.fadeOut("normal",function(){return a.after(d),a.remove(),c?d.fadeIn("fast",function(){return 0===--e.loadingNum&&null!=e.plugin.options.onComplete?e.plugin.options.onComplete(e.plugin.element):void 0}):e.loadingNum--})},a.prototype.replaceSpaceToUnder=function(a){return a.replace(/\s/g,"_")},a.prototype.replaceUnderToSpace=function(a){return a.replace(/_/g," ")},a}(),b=function(a){function b(a){this.plugin=a,b.__super__.constructor.apply(this,arguments)}return e(b,a),b.prototype.loadEmoji=function(){var a,b,c,d,e,f,g=this;return d=function(a){var b,c,d,e,f,h,i;for(e=function(a,b,c){var d;return d=$("<img src='"+g.plugin.ec.cdn_url+g.plugin.ec.size_code+"/"+c+".png'></img>"),d.load(function(){return g.fadeOutLoadingTag_fadeInEmojiTag(b,c)}),d.error(function(){return g.fadeOutLoadingTag_fadeInEmojiTag(b,""+b[0].dataset.emoji,!1)})},d=g.getLoadingElement(a),g.loadingNum=d.length,i=[],f=0,h=d.length;h>f;f++)switch(c=d[f],c.dataset.type){case"code":i.push(e(c.dataset.type,$(c),g.replaceSpaceToUnder(c.dataset.emoji.replace(/:/g,""))));break;case"utf":i.push(function(){var a;a=[];for(b in this.plugin.options.utfEmojiData){if(b===c.dataset.emoji){this.fadeOutLoadingTag_fadeInEmojiTag($(c),this.plugin.options.utfEmojiData[b]);break}a.push(void 0)}return a}.call(g));break;default:i.push(void 0)}return i},a=function(){return 0===--f&&null!=g.plugin.options.onComplete?g.plugin.options.onComplete(g.plugin.element):void 0},b=function(a,b,d,e){return 0===a?c(b,d,e):void 0},c=function(b,c,d){var e,f,h,i;for(f=c,h=0,i=d.length;i>h;h++)e=d[h],f=f.replace(e.matched,function(){return g.getEmojiTag(g.replaceSpaceToUnder(e.code))});return $(b).replaceWith(f),a()},e=function(c){var d,e,f;return"STYLE"!==c.parentElement.tagName?(d=[],f=c.textContent.replace(g.plugin.options.regexpUtf,function(a){var b;for(b in g.plugin.options.utfEmojiData)if(b===a)return g.getEmojiTag(g.plugin.options.utfEmojiData[b])}),f.match(g.regexpCode)?(e=0,f.replace(g.regexpCode,function(){return e++}),f.replace(g.regexpCode,function(a,h){var i;return i=$("<img src='"+g.plugin.ec.cdn_url+g.plugin.ec.size_code+"/"+g.replaceSpaceToUnder(h)+".png'></img>"),i.load(function(){return e--,d.push({matched:a,code:h}),b(e,c,f,d)}),i.error(function(){return e--,b(e,c,f,d)})})):($(c).replaceWith(f),a())):void 0},this.plugin.options.useLoadingImg?(this.setLoadingTag(this.plugin),d(this.plugin.element)):(f=0,this.plugin.element.find(":not(iframe,textarea,script)").andSelf().contents().filter(function(a,b){return b.nodeType===Node.TEXT_NODE&&b.textContent.match(/\S/)?f++:void 0}),this.plugin.element.find(":not(iframe,textarea,script)").andSelf().contents().filter(function(a,b){return b.nodeType===Node.TEXT_NODE&&b.textContent.match(/\S/)?e(b):void 0}))},b}(a),c=function(a){function b(a){this.plugin=a,this.onLoadEmojiData=f(this.onLoadEmojiData,this),b.__super__.constructor.apply(this,arguments)}return e(b,a),b.prototype.loadEmoji=function(){return this.getUserEmojiData(this.plugin.options.userNames,this.onLoadEmojiData)},b.prototype.getUserEmojiData=function(a,b){var c,d,e,f,g,h,i;for(d=0,f=a,c=[],i=[],g=0,h=f.length;h>g;g++)e=f[g],i.push($.ajax({url:"https://www.emojidex.com/api/v1/users/"+e+"/emoji",dataType:"json",type:"get",success:function(a){return c=c.concat(a.emoji),++d===f.length?b(c):void 0},error:function(a){return console.log("error: load json"),console.log(a)}}));return i},b.prototype.onLoadEmojiData=function(a){var b,c,d,e=this;return b=function(a){var b,c,d,e;for(c="",d=0,e=a.length;e>d;d++)b=a[d],null!=b.moji&&(c+=b.moji);return console.log(c)},d=function(a){var b,c,d,e;for(c=[],d=0,e=a.length;e>d;d++)b=a[d],null!=b.moji&&c.push(b.moji);return console.log(c.join("|"))},c=function(a){var b,c,d,f;for(b=[],d=0,f=a.length;f>d;d++)c=a[d],null!=c.moji&&b.push("{utf:'"+c.moji+"',code:'"+e.replaceSpaceToUnder(c.code)+"'}");return console.log("["+b.join(",")+"]")},this.emoji_data=a,this.emoji_regexps=this.getEmojiRegexps(a),this.targetElementNum=this.plugin.element.find(":not(iframe,textarea,script)").andSelf().contents().length-1,this.plugin.element.find(":not(iframe,textarea,script)").andSelf().contents().filter(function(a,b){return b.nodeType===Node.TEXT_NODE&&b.textContent.match(/\S/)&&$(b).replaceWith(e.getTextWithEomojiTag(b.textContent)),e.targetElementNum-a===0&&null!=e.plugin.options.onComplete?e.plugin.options.onComplete(e.plugin.element):void 0})},b.prototype.getEmojiRegexps=function(a){var b,c,d,e,f;for(d=[],c=":(",e=0,f=a.length;f>e;e++)b=a[e],null!=b.moji&&d.push(b.moji),null!=b.code&&(c+=this.replaceSpaceToUnder(b.code)+"|");return d.sort(function(a,b){return b.length-a.length}),{utf:RegExp(d.join("|"),"g"),code:RegExp(c.slice(0,-1)+"):","g")}},b.prototype.getTextWithEomojiTag=function(a){var b=this;return a=a.replace(this.emoji_regexps.utf,function(a){var c,d,e,f;for(f=b.emoji_data,d=0,e=f.length;e>d;d++)if(c=f[d],c.moji===a)return b.getEmojiTag(b.replaceSpaceToUnder(c.code))}),a=a.replace(this.emoji_regexps.code,function(a,c){var d,e,f,g;for(g=b.emoji_data,e=0,f=g.length;f>e;e++)if(d=g[e],b.replaceSpaceToUnder(d.code)===c)return b.getEmojiTag(c)})},b}(a)}.call(this);